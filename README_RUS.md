# Brickgame v1.0

Реализация BrickGame v1.0.

Английскую версию README можно найти в репозитории. 

## Содержание
1. [Внешний вид](#внешний-вид)
2. [Описание проекта](#описание-проекта)
3. [Сборка проекта](#сборка-проекта)
4. [Тестирование](#тестирование)
5. [Обратная связь](#обратная-связь)

<br>

## [Внешний вид](#brickgame-v10)

![1](./misc/img/tetris.gif)

## [Описание проекта](#brickgame-v10)

Цель данного проекта состоит в реализации на языке программирования Си с использованием структурного подхода игры Тетрис. Реализация игры состоит из двух частей: библиотеки, реализующей логику работы игры, которую можно подключать к различным GUI в будущем, и терминального интерфейса. Логика работы библиотеки реализована с использованием конечного автомата.

![2](./misc/img/finite_state_machine.png)

Применяемый КА имеет следующие состояния:

| Название состояния | Описание состояния                                                                                                                 | Доступность состояния |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| `Start`            | Состояние, в котором игра ждет, пока игрок нажмет кнопку готовности к игре                                                         | В главном меню        |
| `Guide`            | Состояние, в котором отображаются назначения клавиш                                                                                | В главном меню        |
| `Configure`        | Состояние, в котором меняются игровые условности (дополнительные настройки: размера поля, игрового блока)                          | В главном меню        |
| `Color scheme`     | Состояние, в котором все игровые элементы меняют цвета (изменение цветовой схемы)                                                  | В любой момент        |
| `Terminate`        | Состояние, в котором игровой цикл досрочно останавливается (мгновенный выход из игры)                                              | В любой момент        |
| `Pause`            | Состояние, в котором игровой цикл останаливается (игровая пауза)                                                                   | Во время игры         |
| `Spawn`            | Состояние, в котором создается следующая фигура                                                                                    | Во время игры         |
| `Move`             | Состояние, которое обрабатывает пользовательский ввод — движение фигуры влево/право или ускоренное падение вниз                    | Во время игры         |
| `Shift`            | Состояние, которое наступает после истечения таймера, при котором активная фигура падает на одну клетку вниз                       | Во время игры         |
| `Attaching`        | Состояние, которое наступает, если движущаяся фигура достигла самой нижней линии или коснулась какой либо клеткой на другую клетку | Во время игры         |
| `Comeback`         | Состояние, которое наступает если после `Attaching` имеется свободное место для появления следующей фигуры                         | Во время игры         |
| `Game over`        | Состояние, которое наступает если после `Attaching` отсутствует свободное место для появления следующей фигуры                     | Во время игры         |

- Программа разработана на языке Си стандарта C11 с использованием компилятора gcc;
- Программа состоит из двух частей: библиотеки, реализующей логику игры тетрис, и терминального интерфейса с использованием библиотеки `ncurses`.
- Для формализации логики игры использован конечный автомат.
- Библиотека имеет функцию, принимающую на вход ввод пользователя, и функцию, выдающую матрицу, которая описывает текущее состояние игрового поля, при каждом ее изменении.
- Код библиотеки программы находится в папке `src/brick_game/tetris`.
- Код с интерфейсом программы находится в папке `src/gui/cli`.
- Сборка программы должна быть настроена с помощью `Makefile` со стандартным набором целей для GNU-программ: `all`, `install`, `uninstall`, `clean`, `dvi`, `dist`, `test`, `gcov_report`. Установка ведется в каталог `bin`.
- Программа разработана в соответствии с принципами структурного программирования.
- Код написан в соответствии с Google Style.
- Обеспечено покрытие библиотеки unit-тестами, с помощью библиотеки `check`. Покрытие библиотеки с логикой игры тестами составляет не менее 80 процентов.
- В игре присутствовуют следующие механики:
  - Вращение фигур;
  - Перемещение фигуры по горизонтали;
  - Ускорение падения фигуры (при зажатии кнопки фигура перемещается до конца вниз);
  - Показ следующей фигуры;
  - Уничтожение заполненных линий;
  - Завершение игры при достижении верхней границы игрового поля;
  - В игре присутствовуют все виды фигур, показанных на картинке ниже.
- Для управления добавлена поддержка всех кнопок, предусмотренных на физической консоли:
  - Начало игры,
  - Пауза,
  - Завершение игры,
  - Стрелка влево — движение фигуры влево,
  - Стрелка вправо — движение фигуры вправо,
  - Стрелка вниз — падение фигуры,
  - Стрелка вверх — ни используется в данной игре,
  - Действие (вращение фигуры).
- Игровое поле соответствовует размерам игрового поля консоли — десять «пикселей» в ширину и двадцать «пикселей» в высоту.
- Фигура останавливается после достижения нижней границы поля или соприкосновения с другой фигурой. После этого происходит генерация следующей фигуры, показанной на превью.
- Пользовательский интерфейс поддерживает отрисовку игрового поля и дополнительной информации.
- Реализован подсчет очков и хранение максимального количества очков.
- Максимальное количество очков изменяется во время игры, если пользователь во время игры превышает текущий показатель максимального количества набранных очков.
- В игру добавлена механика уровней. Каждый раз, когда игрок набирает 600 очков, уровень увеличивается на 1. Повышение уровня увеличивает скорость движения фигур. Максимальное количество уровней — 10.

Начисление очков происходит следующим образом:

1 линия — 100 очков; <br>
2 линии — 300 очков; <br>
3 линии — 700 очков; <br>
4 линии — 1500 очков. <br>

Используемые фигуры:

![3](./misc/img/tetris_pieces.png)

## [Сборка проекта](#brickgame-v10)

В `Makefile` добавлены следующие основные цели для работы с проектом:

| #  | Цель               | Описание цели                                                                   |
|----| ------------------ | ------------------------------------------------------------------------------- |
| 1  | `all`              | Производит сборку проекта и запускает игру                                      |
| 2  | `install`          | Производит сборку проекта                                                       |
| 3  | `uninstall`        | Производит деинсталяцию проекта                                                 |
| 4  | `brickgame`        | Осуществляет сборку модулей в статическую библиотеку                            |
| 4  | `gui_brickgame`    | Осуществляет сборку графических модулей в статическую библиотеку                |
| 5  | `test`             | Производит тестирование модулей                                                 |
| 6  | `gcov_report`      | Производит тестирование модулей и формирует отчет о покрытии в `html` формате   |
| 7  | `dvi`              | Формирует документацию в формате `html` и manual к функционалу                  |
| 8  | `dist`             | Сжимает проект в tar архив                                                      |
| 9  | `clean`            | Производит очистку репозитория от сгенерированных файлов                        |
| 10 | `rebuild`          | Осуществляет пересборку проекта                                                 |
| 11 | `clang_check`      | Тестирование модулей на соответствие `Google style`                             |
| 12 | `cppcheck`         | Тестирование модулей через анализатор кода `cppcheck`                           |
| 13 | `valgrind`         | Тестирование модулей на работу с памятью через `Valgrind`                       |
| 14 | `dependencies`     | Производит установку необходимых зависимостей для cборки и тестирования проекта |
| 15 | `run`              | Запустить игру                                                                  |

<br>

> Для сборки проекта необходима установка библиотеки `ncurses`.

## [Тестирование](#brickgame-v10)

Также с написанным кодом было произведено:

- тестирование `unit-тестами` с использованием библиотеки `check`. <br>
- покрытие кода тестами с выводом в `html` отчет при помощи `gcovr`. <br>
- тестирование на наличие ошибок/утечек через `valgrind`. <br>

![4](./misc/img/test.gif) <br>

## [Обратная связь](#brickgame-v10)

Если имеются вопросы касаемо особенностей или других интересующих вас моментов проекта, то обращайтесь на <br>

|          |                       |
| ---------| --------------------- |
| почту    | gabilov1997@gmail.com |
| telegram | @kossadda             |
| vk       | vk.com/kossadda       |

Спасибо за внимание. Надеюсь, что данный проект вам понравится и будет полезен.

<br>

[К оглавлению](#brickgame-v10)
